# 2단계: 프롬프트 설계 전략

## 🎯 목표
데이터 분석 결과를 바탕으로 3000자 제한 내에서 최적의 시스템 프롬프트 설계 전략 수립

## 📊 평가 지표 심층 분석

### 평가 공식 완전 분해
```
최종 점수 = 0.9 × 정확도 + 0.1 × 길이점수

길이점수 = √(1 - (L/3000)²)
여기서 L = 프롬프트 길이(글자 수)
```

### 길이별 점수 분석 (그래프 기반)
| 길이(자) | 길이점수 | 정확도 90% 시 최종점수 | 정확도 95% 시 최종점수 |
|---------|---------|-------------------|-------------------|
| 0 | 1.000 | 0.910 | 0.955 |
| 500 | 0.986 | 0.909 | 0.954 |
| 1000 | 0.943 | 0.904 | 0.948 |
| 1500 | 0.866 | 0.897 | 0.940 |
| 2000 | 0.745 | 0.885 | 0.926 |
| 2500 | 0.553 | 0.865 | 0.905 |
| 3000 | 0.000 | 0.810 | 0.855 |

### 📈 핵심 인사이트
1. **정확도가 압도적 중요** (90% 가중치)
2. **길이 패널티는 완만함** (2000자까지 0.745점 유지)
3. **극단적 길이 절약 불필요** (500자 vs 1500자 차이 미미)
4. **Sweet Spot**: 1500-2000자 구간

## 🎯 최적화 전략 도출

### 전략 1: 정확도 우선 (추천) ⭐⭐⭐⭐⭐
- **목표 길이**: 1800-2200자
- **정확도 목표**: 95%+
- **예상 점수**: 0.926-0.930
- **철학**: 길이 점수를 일부 포기하고 정확도에 집중

### 전략 2: 균형 접근
- **목표 길이**: 1200-1600자  
- **정확도 목표**: 92%+
- **예상 점수**: 0.915-0.925
- **철학**: 정확도와 길이의 균형점 탐색

### 전략 3: 극단 절약 (비추천)
- **목표 길이**: 800자 이하
- **정확도 목표**: 88%+
- **예상 점수**: 0.890-0.900  
- **위험**: 정보 부족으로 정확도 하락 가능성

## 🏗️ 프롬프트 구조 설계

### 계층적 정보 배치 전략
```
[필수 영역 - 절대 삭제 불가] (약 800자)
1. 역할 정의 (50자)
2. 작업 설명 (100자)  
3. 출력 형식 (100자)
4. 핵심 분류 기준 (550자)

[중요 영역 - 선택적 포함] (약 600자)  
5. 키워드 리스트 (300자)
6. 예외 처리 규칙 (200자)
7. 경계 케이스 가이드 (100자)

[보조 영역 - 공간 여유시] (약 600자)
8. Few-shot 예시 (300자)
9. 추가 주의사항 (200자) 
10. 품질 체크 (100자)
```

### 정보 밀도 최적화
- **압축 표현**: "자동차 관련: 1, 무관: 0" (12자)
- **축약어 활용**: "완성차(OEM)", "전기차(EV)" 
- **리스트 형태**: 나열식 > 문장식
- **핵심만**: 부가 설명 최소화

## 🔍 핵심 분류 기준 설계 (데이터 분석 기반)

### Tier 1: 강한 신호 키워드 (거의 확실히 1)
```
회사: 현대차,기아,삼성SDI,LG이노텍,한온시스템,포티투닷,채비
제품: 전기차,EV,SUV,하이브리드,세단,배터리(자동차용)
기술: 자율주행,ADAS,차량용,충전인프라
산업: 완성차,OEM,부품사,자동차공장,판매대수
```

### Tier 2: 맥락 의존 키워드 (용도 확인 필요)
```
기술: 배터리,반도체,AI,센서,카메라 → 자동차 용도인가?
회사: 삼성,LG,한화 → 자동차 사업인가?
일반: 생산,제조,투자,공장 → 자동차 관련인가?
```

### Tier 3: 배제 신호 키워드 (거의 확실히 0)  
```
분야: 부동산,금융,정치,우주,군사,의료,교육,게임,문화
업종: 통신,포털,유통,건설,조선,항공,화학
```

### 판단 알고리즘
```
1단계: 제목에서 Tier1 키워드 검색 → 발견시 거의 확실히 1
2단계: Tier3 키워드 검색 → 발견시 거의 확실히 0  
3단계: Tier2 키워드의 맥락 분석
   - "전기차 배터리" → 1
   - "태양광 배터리" → 0
4단계: 애매한 경우 보수적 접근 → 0
```

## 🎪 Few-Shot 예시 전략

### 효과적인 예시 선별 (300자 제한)
```
[예시1] 
제목: "현대차 전기차 판매 증가"
분류: 1 (회사명+제품 명확)

[예시2]
제목: "삼성SDI 가전용 배터리 생산"  
분류: 0 (배터리지만 가전용)

[예시3]
제목: "AI 기술 개발 동향"
분류: 0 (자동차 언급 없음)
```

## 🚫 출력 안정성 강화

### 강제 출력 규칙
```
- 반드시 "0" 또는 "1"만 출력
- 설명, 근거, 추가 텍스트 절대 금지
- 띄어쓰기, 문장부호 금지
- 숫자 하나만 출력
```

### 예외 상황 처리
```
- 이해 불가능한 입력 → 0 출력
- 빈 입력 → 0 출력  
- 오류 발생 → 0 출력
- 애매한 경우 → 0 출력 (보수적 접근)
```

## 📝 길이 최적화 기법

### 1. 압축 표현 기법
```
❌ "자동차와 관련이 있으면 1을, 관련이 없으면 0을 출력하시오"
✅ "자동차 관련: 1, 무관: 0"

❌ "다음과 같은 키워드들이 포함된 경우"  
✅ "포함 키워드:"

❌ "위의 기준에 따라 판단하여"
✅ "판단:"
```

### 2. 필수 정보만 선별
```
포함: 역할, 출력형식, 핵심기준, 주요키워드
제외: 인사말, 부가설명, 반복내용, 예의표현
```

### 3. 구조 압축
```
❌ 
"당신은 뉴스 분류 전문가입니다.
주어진 뉴스를 분석하여...
자동차와 관련이 있는지 판단해주세요."

✅
"뉴스 분류: 자동차 관련(1) vs 무관(0)"
```

## 🧪 A/B 테스트 전략

### 버전별 테스트 계획
1. **V1.0**: 기본 구조 (1500자)
2. **V1.1**: 키워드 추가 (1800자)  
3. **V1.2**: 예시 강화 (2000자)
4. **V1.3**: 경계케이스 추가 (2200자)

### 성능 측정 지표
- 정확도 (Accuracy)
- 정밀도 (Precision) 
- 재현율 (Recall)
- F1-Score
- **최종점수** (공식 적용)

## 🎯 최종 전략 추천

### 권장 접근법: **정확도 우선 전략**

**1. 목표 설정**
- 길이: 1800-2000자  
- 정확도: 95%+
- 예상 최종점수: 0.925+

**2. 구성 비율**
- 핵심 분류기준: 40% (720-800자)
- 키워드 매트릭스: 30% (540-600자)  
- 예외처리 규칙: 20% (360-400자)
- 출력형식/예시: 10% (180-200자)

**3. 개발 순서**
1. 핵심 기능 프롬프트 작성 (1000자)
2. 키워드 리스트 추가 (1400자)  
3. 경계케이스 처리 추가 (1800자)
4. 미세 조정 및 압축 (2000자 이내)

**4. 검증 방법**
- 원본 46개 샘플 테스트
- 증강 데이터 200개 테스트  
- 트릭 케이스 50개 테스트
- 최종 성능 측정

이 전략을 바탕으로 다음 단계인 **03_초기_프롬프트_작성.md**로 진행하여 실제 프롬프트를 작성해보겠습니다!